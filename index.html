<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NICU Protocols Agent</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; }
      .wrap { max-width: 900px; margin: 0 auto; }
      textarea { width: 100%; height: 120px; font-size: 16px; padding: 10px; }
      button { padding: 10px 16px; font-size: 16px; }
      .answer { white-space: pre-wrap; background: #f7f7f9; padding: 12px; border-radius: 8px; margin-top: 1rem; }
      .ctx { font-size: 13px; color: #444; background: #fafafa; padding: 8px; border-radius: 6px; }
      .ctx h4 { margin: 0.3rem 0; }
      .ctx-item { margin-bottom: 8px; }
      .footer { margin-top: 2rem; font-size: 12px; color: #666; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>NICU Protocols Q&A Agent</h1>
      <p>Ask a question about the included NICU protocols PDF. The agent will answer only from the file and cite page numbers.</p>
      <textarea id="q" placeholder="e.g., Eligibility criteria for therapeutic hypothermia?"></textarea>
      <br><br>
      <button onclick="ask()">Ask</button>
      <div id="out"></div>
      <div class="footer">
        <p>Educational use only. Not medical advice. Always follow local policies and consult the on-call neonatologist.</p>
      </div>
    </div>
    <script>
      async function ask(){
        const q = document.getElementById('q').value.trim();
        if(!q){ return; }
        const out = document.getElementById('out');
        out.innerHTML = 'Thinking...';
        try{
          const res = await fetch('/api/chat', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({q})
          });
          const data = await res.json();
          if(data.error){
            out.innerHTML = '<div class="answer">Error: '+data.error+'</div>';
            return;
          }
          const a = document.createElement('div');
          a.className = 'answer';
          a.textContent = data.answer;
          const ctx = document.createElement('div');
          ctx.className = 'ctx';
          ctx.innerHTML = '<h4>Top context chunks (debug view)</h4>' + data.contexts.map(c => (
            '<div class="ctx-item"><b>p.'+c.page+'</b> score='+c.score.toFixed(3)+'<br>'+c.text.substring(0,300)+'...</div>'
          )).join('');
          out.innerHTML='';
          out.appendChild(a);
          out.appendChild(ctx);
        }catch(e){
          out.innerHTML = '<div class="answer">Error: '+e.message+'</div>';
        }
      }
    </script>
  </body>
</html>
